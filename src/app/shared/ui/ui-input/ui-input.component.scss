.ui-form-item {
  --background: var(--ion-color-light, rgba(0, 0, 0, 0.02));
  --border-radius: 16px;
  --padding-start: 16px;
  --padding-end: 12px;
  --inner-padding-top: 0;
  --inner-padding-bottom: 0;
  --inner-padding-start: 0;
  --inner-padding-end: 0;
  --min-height: 56px;
  --highlight-height: 0;
  --border-width: 0;
  --inner-border-width: 0;
  --inner-border-style: none;
  --border-color: transparent;
  --box-shadow: none;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  overflow: visible; // allow error slot to be visible below the input
  position: relative;
  transition: box-shadow 0.18s ease, outline-color 0.18s ease;

  /* Remove any borders from ion-item shadow parts (maps to .item-native/.item-inner) */
  &::part(native),
  &::part(inner) {
    display: flex;
    align-items: center;
    border: 0 !important;
    border-width: 0 !important;
    box-shadow: none !important;
  }

  // Strong visible focus ring on the whole item when inner input is focused
  &.item-has-focus {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--ion-color-primary) 25%, transparent);
    outline: 2px solid color-mix(in srgb, var(--ion-color-primary) 55%, transparent);
    outline-offset: 0; // keep ring hugging the pill/rounded shape
    z-index: 1; // ensure the ring renders above neighbors
  }

  &.ion-invalid.ion-touched {
    --box-shadow: 0 0 0 2px
      color-mix(in srgb, var(--ion-color-danger) 14%, transparent);
  }

  // Variants
  &.variant-filled {
    --background: color-mix(
      in srgb,
      var(--ion-background-color) 86%,
      var(--ion-color-step-150)
    );
  }
  &.variant-outline {
    --background: transparent;
    --border-width: 1px;
    --border-color: color-mix(in srgb, var(--ion-text-color) 12%, transparent);
  }
  &.variant-ghost {
    --background: transparent;
  }

  // Sizes
  &.size-sm {
    --min-height: 44px;
    --padding-start: 12px;
    --padding-end: 10px;
  }
  &.size-lg {
    --min-height: 64px;
    --padding-start: 18px;
    --padding-end: 14px;
  }

  // Glassmorphism and shapes
  &.is-glass {
    --background: color-mix(
      in srgb,
      var(--ion-background-color) 70%,
      transparent
    );
    backdrop-filter: saturate(180%) blur(14px);
    -webkit-backdrop-filter: saturate(180%) blur(14px);
    --border-width: 1px;
    --border-color: color-mix(in srgb, var(--ion-text-color) 10%, transparent);
    &.item-has-focus {
      box-shadow:
        0 0 0 3px color-mix(in srgb, var(--ion-color-primary) 22%, transparent),
        0 12px 26px color-mix(in srgb, var(--ion-color-primary) 10%, transparent);
    }
  }
  &.is-pill {
    --border-radius: 999px;
  }

  ion-icon[slot="start"] {
    color: var(--ion-color-medium);
    font-size: 20px;
    margin-right: 10px;
  }

  ion-icon.end-toggle[slot="end"] {
    color: var(--ion-color-medium);
    font-size: 22px;
    margin-left: 8px;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.2s ease;

    &:hover {
      color: var(--ion-color-primary);
    }
    &:active {
      transform: scale(0.96);
    }
  }

  ion-icon.end-clear[slot="end"] {
    color: var(--ion-color-medium);
    font-size: 20px;
    margin-left: 6px;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.2s ease;
    &:hover {
      color: var(--ion-color-primary);
    }
    &:active {
      transform: scale(0.96);
    }
  }

  .ui-form-input {
    flex: 1 1 auto;
    width: 100%;
    min-width: 0;
    --padding-start: 0;
    --padding-end: 0;
    --padding-top: 10px;
    --padding-bottom: 10px;
    --background: transparent;
    --border-width: 0;
    --border-color: transparent;
    --box-shadow: none;
    --highlight-color-focused: transparent;
    --highlight-color: transparent;
    --highlight-color-invalid: transparent;
    --highlight-color-valid: transparent;
    font-size: 16px;

    &::part(container) {
      background: transparent !important;
      border-radius: 0 !important;
      padding: 0 !important;
      box-shadow: none !important;
      border: 0 !important;
      border-bottom: 0 !important;
      width: 100% !important;
      display: flex !important;
      align-items: center !important; // center the input vertically under floating label
    }

    &::part(native) {
      background: transparent !important;
      border: 0 !important;
      border-bottom: 0 !important;
      padding: 0 !important; // center vertically within container
      width: 100% !important;
      outline: none !important; // ring handled on the item container
      box-shadow: none !important;
      /* Ensure visible caret and text color */
      caret-color: var(--ion-color-primary, #4361ee) !important;
      color: var(--ion-text-color) !important;
      -webkit-text-fill-color: var(--ion-text-color) !important; // iOS/Safari caret visibility
      line-height: 1.2 !important;
      height: auto !important;
      min-height: 0 !important;
      appearance: textfield !important;
      -webkit-appearance: none !important;
      -moz-appearance: textfield !important;
    }

    &::part(label) {
      color: var(--ion-color-medium);
      transition: color 0.2s ease;
      max-width: 100%;
      display: block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }

  ion-note[slot="error"] {
    margin-top: 6px;
    font-size: 12px;
    line-height: 1.3;
    color: var(--ion-color-danger);
  }

  .helper-line {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    width: 100%;
    .hint {
      color: var(--ion-color-medium);
    }
    .counter {
      color: var(--ion-color-medium);
      font-variant-numeric: tabular-nums;
    }
  }

  // Focus label color
  &.item-has-focus .ui-form-input::part(label) {
    color: var(--ion-color-primary);
  }

  // Size fine-tuning
  &.size-sm {
    .ui-form-input {
      font-size: 14px;
    }
  }
  &.size-lg {
    .ui-form-input {
      font-size: 18px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      transition: none !important;
      animation: none !important;
    }
  }
}
