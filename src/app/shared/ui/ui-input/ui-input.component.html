<ion-item
  class="ui-form-item"
  lines="none"
  [class.ion-invalid]="isInvalid"
  [class.ion-touched]="ngControl?.control?.touched"
  [class.item-has-focus]="focused"
  [ngClass]="[
    'variant-' + variant,
    'size-' + size,
    glass ? 'is-glass' : '',
    shape === 'pill' ? 'is-pill' : ''
  ]"
>
  <ion-icon
    *ngIf="startIcon"
    slot="start"
    [name]="startIcon"
    aria-hidden="true"
  ></ion-icon>

  <ion-input
    class="ui-form-input"
    [id]="id"
    [label]="label || null"
    [labelPlacement]="labelPlacement"
    [type]="
      type === 'password' && togglePassword
        ? hide
          ? 'password'
          : 'text'
        : type
    "
    [value]="value"
    (ionInput)="onChange($any($event).detail.value)"
    (ionFocus)="focused = true"
    (ionBlur)="focused = false; onTouched()"
    [placeholder]="placeholder"
    [autocomplete]="autocomplete"
    [inputmode]="inputmode"
    [required]="!!required"
    [maxlength]="maxLength ?? null"
    [attr.aria-invalid]="ariaInvalid"
  ></ion-input>

  <!-- Clear button -->
  <ion-icon
    *ngIf="clearable && hasValue && !(type === 'password' && togglePassword)"
    slot="end"
    class="end-clear"
    tabindex="0"
    role="button"
    aria-label="Clear input"
    name="close-circle"
    (click)="clear()"
  ></ion-icon>

  <ion-icon
    *ngIf="type === 'password' && togglePassword"
    slot="end"
    class="end-toggle"
    tabindex="0"
    role="button"
    [attr.aria-label]="hide ? 'Show password' : 'Hide password'"
    [name]="hide ? 'eye-outline' : 'eye-off-outline'"
    (click)="togglePasswordVisibility()"
  ></ion-icon>

  <ion-icon
    *ngIf="!togglePassword && endIcon"
    slot="end"
    [name]="endIcon"
    aria-hidden="true"
  ></ion-icon>

  <!-- Helper / Counter -->
  <ion-note
    *ngIf="hint || maxLength !== undefined"
    slot="helper"
    class="helper-line"
  >
    <span class="hint" *ngIf="hint">{{ hint }}</span>
    <span class="counter" *ngIf="maxLength !== undefined">{{
      (value?.length || 0) + "/" + maxLength
    }}</span>
  </ion-note>

  <ion-note *ngIf="isInvalid" slot="error" color="danger">
    <ng-container *ngIf="ngControl?.control as c">
      <span *ngIf="c.errors?.['required']">{{
        "VALIDATION.REQUIRED" | translate
      }}</span>
      <span *ngIf="c.errors?.['email']">{{
        "VALIDATION.INVALID_EMAIL" | translate
      }}</span>
      <span
        *ngIf="c.errors?.['minlength']"
        >{{ 'VALIDATION.MIN_LENGTH' | translate : { min: c.errors?.['minlength']?.requiredLength } }}</span
      >
      <span
        *ngIf="c.errors?.['maxlength']"
        >{{ 'VALIDATION.MAX_LENGTH' | translate : { max: c.errors?.['maxlength']?.requiredLength } }}</span
      >
      <span *ngIf="c.errors?.['pattern']">{{
        "VALIDATION.INVALID" | translate
      }}</span>
    </ng-container>
  </ion-note>
</ion-item>
